function submitCounter(){let e=document.getElementById("ff-time-alert"),t=document.getElementById("timecounter");if(t){let a=parseInt(document.getElementById("minTime").getAttribute("data-time")),l=document.getElementById("minTime").getAttribute("data-unit");l=l.split(";");let n=setInterval((function(){if(a<=0){clearInterval(n),t.remove();let a=setInterval((function(){e.style.opacity||(e.style.opacity=1),e.style.opacity>0?e.style.opacity-=.1:(clearInterval(a),e.remove())}),200)}let i=l[0];a<=1&&(i=l[1]),t.innerText=a+" "+i,a-=1}),1e3)}}function checkMultiCheckboxesRequired(){const e=document.getElementsByTagName("form");if(e&&e.length)for(let t=0;t<e.length;t++)if(!e[t].noValidate){const a=e[t].querySelectorAll("[data-multicheckbox]");if(a.length){console.log(a);const e=Object.groupBy(a,(e=>e.name));if(Object.keys(e).length)for(let[t,a]of Object.entries(e))for(let e=0;e<a.length;e++)a[e].addEventListener("change",(function(){let l=document.getElementsByName(t);if(a[e].required)for(let e=0;e<l.length;e++)l[e].removeAttribute("required");else for(let e=0;e<l.length;e++)l[e].required=!0}))}}}function handleFileUploads(){const e=new DataTransfer;let t=document.querySelectorAll(".fileupload");if(t.length>0)for(let a=0;a<t.length;a++)t[a].addEventListener("change",(function(){let l=t[a],n=l.hasAttribute("multiple"),i=l.dataset.framework,s=l.id,r=document.getElementById(s+"-files"),o=parseInt(t[a].dataset.filesize),d=0,u=0;l.dataset.maxfilesize&&(d=l.dataset.maxfilesize),l.dataset.maxtotalfilesize&&(u=l.dataset.maxtotalfilesize);let c=!0,f="",m="",p="",g=document.getElementById(s+"-allowedFileSize");if(!g){let e=s;e=e.replace("-fileupload",""),g=document.getElementById(e+"-allowedFileSize")}let h=document.getElementById(s+"-allowedTotalFileSize");for(let t=0;t<this.files.length;t++){let a=this.files[t],s=formatBytes(a.size,2);o+=a.size,n||(r&&(r.innerHTML=""),o=a.size);let u=document.createElement("div");switch(u.className="file-block",0!==d&&a.size>d&&(c=!1),i){case"uikit3":c||(f=" uk-badge-danger",m=" ff-invalid-fs",p="uk-text-danger"),invalidTotalFileSizeNotesClass=" uk-text-danger";let e="<span class='uk-light uk-badge uk-padding-small uk-margin-xsmall-top"+f+"'>";e+="<span class='file-delete uk-margin-xsmall-right'><span data-uk-icon='icon: close'></span></span>",e+="<span class='file-name'>"+a.name+"</span>",e+="<span class='ff-file-size "+m+"'>("+s+")</span></span>",u.innerHTML=e,!g||c||g.hasAttribute("class")?n||g&&g.removeAttribute("class"):g.className+=p,c=!0,f="",m="",p="";break;case"bootstrap5":c?f=" bg-primary":(f=" bg-danger",m=" ff-invalid-fs",p="text-danger"),invalidTotalFileSizeNotesClass=" text-danger";let t="<span class='badge mt-2 p-2"+f+"'>";t+="<span class='file-delete me-1'><span class='ff-close'></span></span>",t+="<span class='file-name'>"+a.name+"</span>",t+="<span class='ff-file-size "+m+"'>("+s+")</span></span>",u.innerHTML=t,!g||c||g.hasAttribute("class")?n||g.removeAttribute("class"):g.className+=p,c=!0,f="",m="";break;default:c||(f=" text-danger",m=" ff-invalid-fs",p="text-danger"),invalidTotalFileSizeNotesClass=" text-danger";let l="<span class='ff-file-item"+f+"'>";l+="<span class='file-delete'><span class='ff-close'></span></span>",l+="<span class='file-name'>"+a.name+"</span>",l+="<span class='ff-file-size "+m+"'>("+s+")</span></span>",u.innerHTML=l,!g||c||g.hasAttribute("class")?n||g.removeAttribute("class"):g.className+=p,f="",m="",c=!0}r&&r.appendChild(u),u.querySelector(".file-delete").addEventListener("click",(t=>deleteFileBlock(t,u,e,l))),e.items.add(a)}let y=document.getElementById(s+"-total");0!==u&&o>u&&(h.className+=invalidTotalFileSizeNotesClass,y&&(y.className+=invalidTotalFileSizeNotesClass)),t[a].dataset.filesize=String(o),y&&(y.innerHTML=formatBytes(o)),this.files=e.files}))}function deleteFileBlock(e,t,a,l){let n=l.dataset.filesize,i=t.querySelector(".file-name").textContent,s=document.getElementById(l.id+"-allowedFileSize"),r=document.getElementById(l.id+"-allowedTotalFileSize"),o=document.getElementById(l.id+"-total"),d=0;t.remove();let u=[];for(let e=0;e<a.items.length;e++){if(i===a.items[e].getAsFile().name){let t=a.items[e].getAsFile().size;a.items.remove(e),d=n-t,l.dataset.filesize=String(d),o&&(o.innerHTML=formatBytes(d));break}u.push(a.items[e].getAsFile().size)}u.every((e=>e<=l.dataset.maxfilesize))&&(o&&o.removeAttribute("class"),s&&s.removeAttribute("class")),Number.isInteger(d)&&l.dataset.maxtotalfilesize&&d<=l.dataset.maxtotalfilesize&&r&&r.removeAttribute("class"),document.querySelector(".fileupload").files=a.files}function initializeConditionalFields(){let e=document.getElementsByTagName("form");if(e.length>0)for(let t=0;t<e.length;t++){let a=e[t].id;a&&("undefined"!=typeof mfConditionalFields&&mfConditionalFields("#"+a,{rules:"inline",dynamic:!0,debug:!0}),e[t].getAttribute("data-valid")&&jumpTo(a+"-alert"))}}function editLinks(){let e=document.getElementsByClassName("ff-edit-link");if(e&&e.length>0)for(let t=0;t<e.length;t++)e[t].addEventListener("click",(function(a){a.preventDefault();let l=e[t].dataset.element,n=document.getElementById(l);if(n)if(e[t].textContent===e[t].dataset.edit)n.classList.remove("ff-final-list-hidden"),e[t].textContent=e[t].dataset.close;else{n.classList.add("ff-final-list-hidden"),e[t].textContent=e[t].dataset.edit;let a=n.getElementsByClassName("inputwrap")[0],l=a.children[0].value;if(void 0===l){let e=[],t=a.getElementsByTagName("input");if(t.length>0)for(let a=0;a<t.length;a++){let l=t[a];l.checked&&e.push(l.value)}l=e.length>0?e.toString():""}e[t].parentElement.previousSibling.innerHTML=l}}))}function prevLinks(){let e=document.getElementsByClassName("ff-prev-button");if(e&&e.length>0)for(let t=0;t<e.length;t++)e[t].addEventListener("click",(function(a){a.preventDefault(),window.location.href=e[t].dataset.prev}))}function formatBytes(e,t=2){if(!+e)return"0 B";const a=t<0?0:t,l=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,l)).toFixed(a))+" "+["B","KB","MB","GB","TB","PB","EB","ZB","YB"][l]}function reloadCaptcha(e,t){t.preventDefault();let a=document.getElementById(e);if(a){let e=a.src;e=removeURLParameter(e,"time"),a.src=e+"&time="+Date.now()}}function removeURLParameter(e,t){let a=e.split("?");if(a.length>=2){let l=encodeURIComponent(t)+"=",n=a[1].split(/[&;]/g);for(let e=n.length;e-- >0;)-1!==n[e].lastIndexOf(l,0)&&n.splice(e,1);return e=a[0]+"?"+n.join("&")}return e}window.addEventListener("DOMContentLoaded",(function(){submitCounter(),ajaxSubmit(),maxCharsCounterReverse(),handleFileUploads(),editLinks(),prevLinks(),initializeConditionalFields(),checkMultiCheckboxesRequired();let e=document.getElementsByTagName("button");for(let t=0;t<e.length;t++)"submit"===e[t].type&&e[t].addEventListener("click",(function(e){openHiddenWrapper(e),openHiddenWrapper(e)}));let t=document.querySelectorAll("[data-ffsuccess]");if(t.length>0)for(let e=0;e<t.length;e++)if(0===e){jumpTo(t[e].id)}})),document.addEventListener("click",(function(e){if(e.target.classList.contains("pwtoggle")){let t=e.target.parentNode.previousElementSibling;"password"===t.type?t.type="text":t.type="password"}}));let numInputs=document.querySelectorAll("input");for(let e=0;e<numInputs.length;e++)numInputs[e].addEventListener("change",changeHTML5AttributeValue,!1),numInputs[e].addEventListener("change",calculateTimeRange,!1);function changeHTML5AttributeValue(){let e=this.id.replace(this.form.id+"-",""),t=document.querySelectorAll("[data-ff_field="+e+"]");if(t.length>0)for(let e=0;e<t.length;e++){let a=document.getElementById(t[e].id);if(a){let e=a.dataset.ff_attribute,t=a.dataset.ff_validator,l=this.value;e&&l&&(t&&("dateBeforeField"===t&&(l=calculateBeforeAfterValue(-1,l),l=l.toISOString().split("T")[0]),"dateAfterField"===t&&(l=calculateBeforeAfterValue(1,l),l=l.toISOString().split("T")[0])),a.setAttribute(e,l))}}}function calculateBeforeAfterValue(e,t){let a=new Date(t);return a.setDate(a.getDate()+e),a}function calculateTimeRange(){this.id.replace(this.form.id+"-","");let e=document.querySelectorAll("[data-ff_validator]");if(e.length>0)for(let t=0;t<e.length;t++){let a=document.getElementById(e[t].id);if(a&&("dateWithinDaysRange"===a.dataset.ff_validator||"dateOutsideOfDaysRange"===a.dataset.ff_validator)){let e=a.dataset.ff_attribute,t=this.value,l=a.dataset.ff_days;if("min"===e){if(e&&t){let e=calculateNewDate(t,l,"+");e=new Date(e).toISOString().slice(0,10),"dateOutsideOfDaysRange"===a.dataset.ff_validator?l>0?a.setAttribute("min",e):l<0?a.setAttribute("max",e):a.removeAttribute("max"):l>0?(a.setAttribute("min",t),a.setAttribute("max",e)):(a.setAttribute("max",t),a.setAttribute("min",e))}}else a.removeAttribute("max")}}}function calculateNewDate(e,t,a){let l=new Date(e);return"+"===a?l.setDate(l.getDate()+parseInt(t)):l.setDate(l.getDate()-parseInt(t)),l}function jumpTo(e){let t=location.href;location.href="#"+e,history.replaceState(null,null,t)}function ajaxSubmit(e=null){if(e){subAjax(document.getElementById(e))}else{let e=document.querySelectorAll("[data-submitajax]");if(e.length){let t=0;for(;t<e.length;t++)subAjax(e[t])}}}function subAjax(e){"string"==typeof e&&(e=document.getElementById(e)),e&&e.addEventListener("submit",(function(t){t.preventDefault();let a=e.dataset.submitajax,l=e.getAttribute("action"),n=document.getElementById(a+"-form-submission");n&&(n.style.display=null);l.split(/#(.*)/)[1];let i=new XMLHttpRequest;i.upload.addEventListener("progress",(function(e){if(e.lengthComputable){let t=Math.round(e.loaded/e.total*100);t-=1;let l=document.getElementById(a+"-progressbar");l&&(l.dataset.percent=String(t),l.style.width=t+"%")}})),i.onload=function(){let e=this.responseText;let l=(new DOMParser).parseFromString(e,"text/html").getElementById(a+"-ajax-wrapper"),n=l.innerHTML;if(4===i.readyState&&200===i.status){let e=a+"-ajax_redirect",i=o.get(e);if("1"===l.dataset.validated){let e="";if(i){let t=i.split("#");if(t.length>1){i=t[0],e="#"+t[1]}window.location=i+e}else document.getElementById(a+"-ajax-wrapper").innerHTML=n,jumpTo(a+"-ajax-wrapper")}else document.getElementById(a+"-ajax-wrapper").innerHTML=n,jumpTo(a+"-ajax-wrapper"),reloadCaptcha(a+"-captcha-image",t),ajaxSubmit(),submitCounter(),handleFileUploads(),editLinks(),prevLinks(),initializeConditionalFields(),checkMultiCheckboxesRequired(),"undefined"!=typeof stars&&null!==stars&&stars.rebuild(),"function"==typeof listenToSliderCaptchaCheckboxes&&listenToSliderCaptchaCheckboxes()}};let s=e.method;s=s.toUpperCase();["POST","GET"].includes(s)||(s="POST");let r,o=new FormData(e);"GET"===s&&(r=new URLSearchParams(o),l=l+"?"+String(r)),i.open(s,l),i.setRequestHeader("X-Requested-With","XMLHttpRequest"),i.send(o)}))}function maxCharsCounterReverse(){const e=document.querySelector("textarea");e&&e.addEventListener("input",(e=>{const t=e.currentTarget,a=t.getAttribute("maxlength");if(a){const e=t.value.length,l=document.getElementById(t.id+"-char_count");l&&(e===a?l.innerHTML=l.dataset.maxreached:l.children[0].innerHTML=String(a-e))}}))}function openHiddenWrapper(e){let t=e.target.form;if(!t.hasAttribute("novalidate")&&t.hasAttribute("data-step")&&"last"===t.dataset.step){let e=t.id;for(let a=0;a<t.elements.length;a++){let l=t.elements[a];if(("INPUT"===l.nodeName||"TEXTAREA"===l.nodeName||"SELECT"===l.nodeName)&&(void 0!==l.willValidate&&("INPUT"===l.nodeName&&l.type!==l.getAttribute("type")&&l.setCustomValidity(LegacyValidation(l)?"":"error"),l.checkValidity()),!l.validity.valid)){let t=l.id,a=t.replace(e+"-",""),n=document.getElementById(a+"-hidden-wrapper");if(n){n.classList.remove("ff-final-list-hidden");let e=document.getElementById(t+"-edit"),a=e.dataset.close;e.innerHTML=a}break}}}}
