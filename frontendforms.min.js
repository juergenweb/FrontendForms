function submitCounter(){let timeAlert=document.getElementById("ff-time-alert");let el=document.getElementById("timecounter");if(el){let timeleft=parseInt(document.getElementById("minTime").getAttribute("data-time"));let timetext=document.getElementById("minTime").getAttribute("data-unit");timetext=timetext.split(";");let downloadTimer=setInterval(function(){if(timeleft<=0){clearInterval(downloadTimer);el.remove();let fadeEffect=setInterval(function(){if(!timeAlert.style.opacity){timeAlert.style.opacity=1}if(timeAlert.style.opacity>0){timeAlert.style.opacity-=0.1}else{clearInterval(fadeEffect);timeAlert.remove()}},200)}let text=timetext[0];if(timeleft<=1){text=timetext[1]}el.innerText=timeleft+" "+text;timeleft-=1},1000)}}function checkMultiCheckboxesRequired(){const forms=document.getElementsByTagName('form');if(forms&&forms.length){for(let i=0;i<forms.length;i+=1){if(!forms[i].noValidate){const checkboxes=forms[i].querySelectorAll('[data-multicheckbox]');if(checkboxes.length){const groupedByName=Object.groupBy(checkboxes,checkbox=>checkbox.name);if(Object.keys(groupedByName).length){for(let[key,value]of Object.entries(groupedByName)){let hasValue=false;for(let j=0;j<value.length;j+=1){if(value[j].checked){hasValue=true}}for(let j=0;j<value.length;j+=1){if(hasValue){value[j].required=false}value[j].addEventListener('change',function(){let items=document.getElementsByName(key);if(value[j].required){for(let k=0;k<items.length;k+=1){items[k].removeAttribute("required")}}else{for(let l=0;l<items.length;l+=1){items[l].required=true}}})}}}}}}}}function handleFileUploads(){const dt=new DataTransfer();let fileuploadFields=document.querySelectorAll(".fileupload");if(fileuploadFields.length>0){for(let i=0;i<fileuploadFields.length;i+=1){fileuploadFields[i].addEventListener("change",function(){let fieluploadField=fileuploadFields[i];let multiple=fieluploadField.hasAttribute("multiple");let framework=fieluploadField.dataset.framework;let fileuploadFieldID=fieluploadField.id;let fileList=document.getElementById(fileuploadFieldID+"-files");let totalFileSize=parseInt(fileuploadFields[i].dataset.filesize);let allowedFileSize=0;let allowedTotalFileSize=0;if(fieluploadField.dataset.maxfilesize){allowedFileSize=fieluploadField.dataset.maxfilesize}if(fieluploadField.dataset.maxtotalfilesize){allowedTotalFileSize=fieluploadField.dataset.maxtotalfilesize}let validFileSize=true;let invalidFileSizeClass="";let invalidfilezSizeSpanClass="";let invalidNotesClass="";let notesAllowedFileSizeElement=document.getElementById(fileuploadFieldID+"-allowedFileSize");if(!notesAllowedFileSizeElement){let str=fileuploadFieldID;str=str.replace("-fileupload","");notesAllowedFileSizeElement=document.getElementById(str+"-allowedFileSize")}let notesAllowedTotalFileSizeElement=document.getElementById(fileuploadFieldID+"-allowedTotalFileSize");for(let i=0;i<this.files.length;i+=1){let file=this.files[i];let fileSize=formatBytes(file.size,2);totalFileSize+=file.size;if(!multiple){if(fileList){fileList.innerHTML=""}totalFileSize=file.size}let fileBlock=document.createElement("div");fileBlock.className="file-block";if(allowedFileSize!==0&&file.size>allowedFileSize){validFileSize=false}switch(framework){case "uikit3":if(!validFileSize){invalidFileSizeClass=" uk-badge-danger";invalidfilezSizeSpanClass=" ff-invalid-fs";invalidNotesClass="uk-text-danger"}invalidTotalFileSizeNotesClass=" uk-text-danger";let badgeContentUK="<span class='uk-light uk-badge uk-padding-small uk-margin-xsmall-top"+invalidFileSizeClass+"'>";badgeContentUK+="<span class='file-delete uk-margin-xsmall-right'><span data-uk-icon='icon: close'></span></span>";badgeContentUK+="<span class='file-name'>"+file.name+"</span>";badgeContentUK+="<span class='ff-file-size "+invalidfilezSizeSpanClass+"'>("+fileSize+")</span></span>";fileBlock.innerHTML=badgeContentUK;if(notesAllowedFileSizeElement&&!validFileSize&&!notesAllowedFileSizeElement.hasAttribute("class")){notesAllowedFileSizeElement.className+=invalidNotesClass}else{if(!multiple){if(notesAllowedFileSizeElement){notesAllowedFileSizeElement.removeAttribute("class")}}}validFileSize=true;invalidFileSizeClass="";invalidfilezSizeSpanClass="";invalidNotesClass="";break;case "bootstrap5":if(!validFileSize){invalidFileSizeClass=" bg-danger";invalidfilezSizeSpanClass=" ff-invalid-fs";invalidNotesClass="text-danger"}else{invalidFileSizeClass=" bg-primary"}invalidTotalFileSizeNotesClass=" text-danger";let badgeContentBS="<span class='badge mt-2 p-2"+invalidFileSizeClass+"'>";badgeContentBS+="<span class='file-delete me-1'><span class='ff-close'></span></span>";badgeContentBS+="<span class='file-name'>"+file.name+"</span>";badgeContentBS+="<span class='ff-file-size "+invalidfilezSizeSpanClass+"'>("+fileSize+")</span></span>";fileBlock.innerHTML=badgeContentBS;if(notesAllowedFileSizeElement&&!validFileSize&&!notesAllowedFileSizeElement.hasAttribute("class")){notesAllowedFileSizeElement.className+=invalidNotesClass}else{if(!multiple){notesAllowedFileSizeElement.removeAttribute("class")}}validFileSize=true;invalidFileSizeClass="";invalidfilezSizeSpanClass="";break;default:if(!validFileSize){invalidFileSizeClass=" text-danger";invalidfilezSizeSpanClass=" ff-invalid-fs";invalidNotesClass="text-danger"}invalidTotalFileSizeNotesClass=" text-danger";let badgeContentDef="<span class='ff-file-item"+invalidFileSizeClass+"'>";badgeContentDef+="<span class='file-delete'><span class='ff-close'></span></span>";badgeContentDef+="<span class='file-name'>"+file.name+"</span>";badgeContentDef+="<span class='ff-file-size "+invalidfilezSizeSpanClass+"'>("+fileSize+")</span></span>";fileBlock.innerHTML=badgeContentDef;if(notesAllowedFileSizeElement&&!validFileSize&&!notesAllowedFileSizeElement.hasAttribute("class")){notesAllowedFileSizeElement.className+=invalidNotesClass}else{if(!multiple){notesAllowedFileSizeElement.removeAttribute("class")}}invalidFileSizeClass="";invalidfilezSizeSpanClass="";validFileSize=true}if(fileList){fileList.appendChild(fileBlock)}fileBlock.querySelector(".file-delete").addEventListener("click",(e)=>deleteFileBlock(e,fileBlock,dt,fieluploadField));dt.items.add(file)}let totalSizeDiv=document.getElementById(fileuploadFieldID+"-total");if(allowedTotalFileSize!==0&&totalFileSize>allowedTotalFileSize){notesAllowedTotalFileSizeElement.className+=invalidTotalFileSizeNotesClass;if(totalSizeDiv){totalSizeDiv.className+=invalidTotalFileSizeNotesClass}}fileuploadFields[i].dataset.filesize=String(totalFileSize);if(totalSizeDiv){totalSizeDiv.innerHTML=formatBytes(totalFileSize)}this.files=dt.files})}}}function deleteFileBlock(e,fileBlock,dt,inputfield){let totalFileSize=inputfield.dataset.filesize;let name=fileBlock.querySelector(".file-name").textContent;let notesAllowedFileSizeElement=document.getElementById(inputfield.id+"-allowedFileSize");let notesAllowedTotalFileSizeElement=document.getElementById(inputfield.id+"-allowedTotalFileSize");let totalSizeDiv=document.getElementById(inputfield.id+"-total");let newTotalFileSize=0;fileBlock.remove();let fileSizes=[];for(let i=0;i<dt.items.length;i+=1){if(name===dt.items[i].getAsFile().name){let fileSizeRemoved=dt.items[i].getAsFile().size;dt.items.remove(i);newTotalFileSize=totalFileSize-fileSizeRemoved;inputfield.dataset.filesize=String(newTotalFileSize);if(totalSizeDiv){totalSizeDiv.innerHTML=formatBytes(newTotalFileSize)}break}else{fileSizes.push(dt.items[i].getAsFile().size)}}if(fileSizes.every(value=>{return value<=inputfield.dataset.maxfilesize})){if(totalSizeDiv){totalSizeDiv.removeAttribute("class")}if(notesAllowedFileSizeElement){notesAllowedFileSizeElement.removeAttribute("class")}}if(Number.isInteger(newTotalFileSize)&&inputfield.dataset.maxtotalfilesize&&newTotalFileSize<=inputfield.dataset.maxtotalfilesize){if(notesAllowedTotalFileSizeElement){notesAllowedTotalFileSizeElement.removeAttribute("class")}}document.querySelector(".fileupload").files=dt.files}function initializeConditionalFields(){let frontendforms=document.getElementsByTagName("form");if(frontendforms.length>0){for(let i=0;i<frontendforms.length;i+=1){let form=frontendforms[i];let formID=frontendforms[i].id;if(formID){if(typeof mfConditionalFields!=="undefined"){mfConditionalFields("#"+formID,{rules:"inline",dynamic:true,debug:true})}if(frontendforms[i].getAttribute("data-valid")){let allwrapper=document.getElementById(formID+"-allwrapper");jumpTo(allwrapper,formID+"-alert")}}}}}window.addEventListener("DOMContentLoaded",function(){submitCounter();ajaxSubmit();maxCharsCounterReverse();handleFileUploads();editLinks();prevLinks();initializeConditionalFields();checkMultiCheckboxesRequired();let submitButtons=document.getElementsByTagName("button");for(let i=0;i<submitButtons.length;i+=1){if(submitButtons[i].type==="submit"){submitButtons[i].addEventListener("click",function(e){openHiddenWrapper(e);openHiddenWrapper(e)})}}let successAlerts=document.querySelectorAll('[data-ffsuccess]');if(successAlerts.length>0){for(let i=0;i<successAlerts.length;i+=1){if(i===0){let alertID=successAlerts[i].id;let formID=successAlerts[i].dataset.formid;let allwrapper=document.getElementById(formID+"-allwrapper");jumpTo(allwrapper,alertID)}}}});function editLinks(){let editLinks=document.getElementsByClassName("ff-edit-link");if(editLinks&&editLinks.length>0){for(let i=0;i<editLinks.length;i+=1){editLinks[i].addEventListener("click",function(e){e.preventDefault();let id=editLinks[i].dataset.element;let wrapper=document.getElementById(id);if(wrapper){if((editLinks[i]).textContent===editLinks[i].dataset.edit){wrapper.classList.remove("ff-final-list-hidden");editLinks[i].textContent=editLinks[i].dataset.close}else{wrapper.classList.add("ff-final-list-hidden");editLinks[i].textContent=editLinks[i].dataset.edit;let inputwrapper=wrapper.getElementsByClassName("inputwrap")[0];let newValue=inputwrapper.children[0].value;if(newValue===undefined){let values=[];let inputs=inputwrapper.getElementsByTagName('input');if(inputs.length>0){for(let i=0;i<inputs.length;i+=1){let input=inputs[i];if(input.checked){values.push(input.value)}}}if(values.length>0){newValue=values.toString()}else{newValue=''}}editLinks[i].parentElement.previousSibling.innerHTML=newValue}}})}}}function prevLinks(){let prevLinks=document.getElementsByClassName("ff-prev-button");if(prevLinks&&prevLinks.length>0){for(let i=0;i<prevLinks.length;i+=1){prevLinks[i].addEventListener("click",function(e){e.preventDefault();window.location.href=prevLinks[i].dataset.prev})}}}function formatBytes(bytes,decimals=2){if(!+bytes){return "0 B"}const k=1024;const dm=decimals<0?0:decimals;const sizes=["B","KB","MB","GB","TB","PB","EB","ZB","YB"];const i=Math.floor(Math.log(bytes)/Math.log(k));return parseFloat((bytes/Math.pow(k,i)).toFixed(dm))+" "+sizes[i]}function reloadCaptcha(id,event){event.preventDefault();let captcha=document.getElementById(id);if(captcha){let src=captcha.src;src=removeURLParameter(src,"time");captcha.src=src+"&time="+Date.now()}}document.addEventListener("click",function(element){if(element.target.classList.contains("pwtoggle")){let passwordInput=element.target.parentNode.previousElementSibling;if(passwordInput.type==="password"){passwordInput.type="text"}else{passwordInput.type="password"}}});function removeURLParameter(url,parameter){let urlparts=url.split("?");if(urlparts.length>=2){let prefix=encodeURIComponent(parameter)+"=";let pars=urlparts[1].split(/[&;]/g);for(let i=pars.length;i-- >0;){if(pars[i].lastIndexOf(prefix,0)!==-1){pars.splice(i,1)}}url=urlparts[0]+"?"+pars.join("&");return url}else{return url}}let numInputs=document.querySelectorAll("input,select");for(let i=0;i<numInputs.length;i+=1){numInputs[i].addEventListener("input",changeHTML5AttributeValue,false);numInputs[i].addEventListener("change",calculateTimeRange,false)}function requiredIfEqualHTML5Validation(field,compareField){let value;switch(compareField.type){case "checkbox":value=requiredIfEqualCheckbox(field,compareField);break;case "select-one":case "select-multiple":value=requiredIfEqualSelect(field,compareField);break;default:value=requiredIfEqualDefault(field,compareField)}return value}function requiredIfEqualCheckbox(field,compareField){let i;let comparisonValue="";let compareValue=field.dataset.ff_equal;if(compareValue&&compareValue.includes("|")){compareValue=compareValue.split('|')}if(compareField.checked){if(compareField.value!=="on"){comparisonValue=compareField.value}else{compareValue=comparisonValue="ff-equal-checked"}}let matches;if(Array.isArray(compareValue)){let operator=field.dataset.ff_operator;let checked=[];let chks=document.getElementsByName(compareField.name);if(operator==="AND"){compareValue=compareValue.map(String);for(i=0;i<chks.length;i+=1){if(chks[i].checked){checked.push(chks[i].value)}}if(compareValue.every(r=>checked.includes(r))){return "required"}return ""}else{compareValue=compareValue.map(String);for(i=0;i<chks.length;i+=1){if(chks[i].checked){checked.push(chks[i].value)}}matches=checked.filter(e=>compareValue.indexOf(e)!==-1);if(matches.length>0){return "required"}return ""}}else{let chks=document.getElementsByName(compareField.name);if(chks.length>1){let checked=[];for(i=0;i<chks.length;i+=1){if(chks[i].checked){checked.push(chks[i].value)}}matches=checked.filter(e=>compareValue.indexOf(e)!==-1);if(matches.length>0){return "required"}return ""}else{if(comparisonValue==="ff-equal-checked"){return "required"}else{if(comparisonValue==compareValue){return "required"}}return ""}}}function requiredIfEqualSelect(field,compareField){let i;let compareValue=field.dataset.ff_equal;if(compareValue.includes("|")){compareValue=compareValue.split('|')}let matches;if(Array.isArray(compareValue)){let operator=field.dataset.ff_operator;if(!operator){operator="AND"}let selected=[];let select=document.querySelector("[name='"+compareField.name+"']");let options=select.options;if(operator==="AND"){compareValue=compareValue.map(String);for(i=0;i<options.length;i+=1){if(options[i].selected){selected.push(options[i].value)}}if(compareValue.every(r=>selected.includes(r))){return "required"}return ""}else{compareValue=compareValue.map(String);for(i=0;i<options.length;i+=1){if(options[i].selected){selected.push(options[i].value)}}matches=selected.filter(e=>compareValue.indexOf(e)!==-1);if(matches.length>0){return "required"}return ""}}else{if(compareField.value==compareValue){return "required"}return ""}}function requiredIfEqualDefault(field,compareField){let compareValue=field.dataset.ff_equal;if(compareValue.includes("|")){compareValue=compareValue.split('|')}if(Array.isArray(compareValue)){if(compareValue.includes(compareField.value)){return "required"}return ""}else{if(compareField.value==compareValue){return "required"}return ""}}function changeHTML5AttributeValue(){let field_data_ID=this.name.replace(this.form.id+"-","");let fieldName=field_data_ID.replace(/[[]]/g,'');if(field_data_ID){let fields=document.querySelectorAll("[data-ff_field="+fieldName+"]");if(fields.length>0){for(let i=0;i<fields.length;i+=1){let field=document.getElementById(fields[i].id);if(field){let attribute=field.dataset.ff_attribute;if(attribute==="ff-required"){attribute="required"}let value=this.value;let validator=field.dataset.ff_validator;let label=document.querySelector("label[for='"+field.name+"']");let labelText=label.innerHTML;if(attribute&&value){if(validator){if(validator==="dateBeforeField"){value=calculateBeforeAfterValue(-1,value);value=value.toISOString().split("T")[0]}if(validator==="dateAfterField"){value=calculateBeforeAfterValue(1,value);value=value.toISOString().split("T")[0]}if(validator==="requiredIfEmpty"){value='required'}if((validator==="requiredIfEqual")){value=requiredIfEqualHTML5Validation(field,this)}}if(value=="required"){label.innerHTML=labelText+asterisk}field.setAttribute(attribute,value)}if(attribute&&!value){if((validator==="requiredIfEmpty")||(validator==="requiredIfEqual")){field.removeAttribute(attribute);labelText=labelText.replace(asterisk,"");label.innerHTML=labelText}}}}}}}function calculateBeforeAfterValue(days,value){let result=new Date(value);result.setDate(result.getDate()+days);return result}function calculateTimeRange(){this.id.replace(this.form.id+"-","");let fields=document.querySelectorAll("[data-ff_validator]");if(fields.length>0){for(let i=0;i<fields.length;i+=1){let field=document.getElementById(fields[i].id);if(field&&((field.dataset.ff_validator==="dateWithinDaysRange")||(field.dataset.ff_validator==="dateOutsideOfDaysRange"))){let attribute=field.dataset.ff_attribute;let value=this.value;let days=field.dataset.ff_days;if(attribute==="min"){if(attribute&&value){let value2=calculateNewDate(value,days,"+");value2=new Date(value2).toISOString().slice(0,10);if(field.dataset.ff_validator==="dateOutsideOfDaysRange"){if(days>0){field.setAttribute("min",value2)}else if(days<0){field.setAttribute("max",value2)}else{field.removeAttribute("max")}}else{if(days>0){field.setAttribute("min",value);field.setAttribute("max",value2)}else{field.setAttribute("max",value);field.setAttribute("min",value2)}}}}else{field.removeAttribute("max")}}}}}function calculateNewDate(date,days,operator){let result=new Date(date);if(operator==="+"){result.setDate(result.getDate()+parseInt(days))}else{result.setDate(result.getDate()-parseInt(days))}return result}function jumpTo(allwrapper,anchor_id){if(allwrapper.dataset.preventjumptoform==="false"){let url=location.href;location.href="#"+anchor_id;history.replaceState(null,null,url);}}function ajaxSubmit(formid=null){if(formid){let form=document.getElementById(formid);subAjax(form)}else{let pageforms=document.querySelectorAll("[data-submitajax]");if(pageforms.length){let i=0;for(i;i<pageforms.length;i+=1){subAjax(pageforms[i])}}}}function subAjax(form){if(typeof(form)=="string"){form=document.getElementById(form)}if(form){form.addEventListener("submit",function(e){e.preventDefault();let formid=form.dataset.submitajax;let action=form.getAttribute("action");let progress=document.getElementById(formid+"-form-submission");if(progress){progress.style.display=null}let anchor=action.split(/#(.*)/)[1];if(anchor==="undefined"){}let xhr=new XMLHttpRequest();xhr.upload.addEventListener("progress",function(event){if(event.lengthComputable){let percent=Math.round((event.loaded/event.total)*100);percent=percent-1;let progressBar=document.getElementById(formid+"-progressbar");if(progressBar){progressBar.dataset.percent=String(percent);progressBar.style.width=percent+"%"}}});xhr.onload=function(){let result=this.responseText;const parser=new DOMParser();let doc=parser.parseFromString(result,"text/html");let wrapper=doc.getElementById(formid+"-ajax-wrapper");let content=wrapper.innerHTML;if(xhr.readyState===4&&xhr.status===200){let redirectFieldName=formid+"-ajax_redirect";let redirectUrl=formData.get(redirectFieldName);if(wrapper.dataset.validated==="1"){let anchorQueryString="";if(redirectUrl){let urlParts=redirectUrl.split("#");if(urlParts.length>1){redirectUrl=urlParts[0];let anchor=urlParts[1];anchorQueryString="#"+anchor}window.location=redirectUrl+anchorQueryString}else{document.getElementById(formid+"-ajax-wrapper").innerHTML=content;let allwrapper=document.getElementById(formid+"-allwrapper");jumpTo(allwrapper,formid+"-ajax-wrapper")}}else{document.getElementById(formid+"-ajax-wrapper").innerHTML=content;let allwrapper=document.getElementById(formid+"-allwrapper");jumpTo(allwrapper,formid+"-ajax-wrapper");reloadCaptcha(formid+"-captcha-image",e);ajaxSubmit();submitCounter();handleFileUploads();editLinks();prevLinks();initializeConditionalFields();checkMultiCheckboxesRequired();if(typeof stars!=="undefined"&&stars!==null){stars.rebuild()}if(typeof listenToSliderCaptchaCheckboxes==="function"){listenToSliderCaptchaCheckboxes()}}}};let method=form.method;method=method.toUpperCase();const allowedMethods=["POST","GET"];if(!allowedMethods.includes(method)){method="POST"}let formData=new FormData(form);let queryString;if(method==="GET"){queryString=new URLSearchParams(formData);action=action+"?"+String(queryString)}xhr.open(method,action);xhr.setRequestHeader("X-Requested-With","XMLHttpRequest");xhr.send(formData)})}}function maxCharsCounterReverse(){const textarea=document.querySelector("textarea");if(!textarea){return}textarea.addEventListener("input",event=>{const target=event.currentTarget;const maxLength=target.getAttribute("maxlength");if(maxLength){const currentLength=target.value.length;const counterSpan=document.getElementById(target.id+"-char_count");if(counterSpan){if(currentLength===maxLength){counterSpan.innerHTML=counterSpan.dataset.maxreached}else{counterSpan.children[0].innerHTML=String(maxLength-currentLength)}}}})}function openHiddenWrapper(event){let form=event.target.form;if(!form.hasAttribute("novalidate")&&form.hasAttribute("data-step")&&form.dataset.step==="last"){let formID=form.id;for(let f=0;f<form.elements.length;f+=1){let field=form.elements[f];if(field.nodeName!=="INPUT"&&field.nodeName!=="TEXTAREA"&&field.nodeName!=="SELECT"){continue}if(typeof field.willValidate!=="undefined"){if(field.nodeName==="INPUT"&&field.type!==field.getAttribute("type")){field.setCustomValidity(LegacyValidation(field)?"":"error")}field.checkValidity()}if(!field.validity.valid){let fieldID=field.id;let fieldName=fieldID.replace(formID+"-","");let hiddenWrapper=document.getElementById(fieldName+"-hidden-wrapper");if(hiddenWrapper){hiddenWrapper.classList.remove("ff-final-list-hidden");let toggleLink=document.getElementById(fieldID+"-edit");let closeText=toggleLink.dataset.close;toggleLink.innerHTML=closeText}break}}}}
